#!/bin/bash
[ -z "$1" ] && printf "%s\n" "Missing Youtube Link. Use --help for help." && exit 1

player=ffplay

while test $# -gt 0; do
    case $1 in
        --help)
            echo "ffyt - play youtube videos/streams in ffmpeg/vlc"
            echo "--help      print help"
            echo "-f          play in ffplay" echo "-v          play in vlc"
            exit 0
            ;;
        -v)
            player="vlc"
            shift
            ;;
        -m)
            streamInfo=$(curl -s "$2")
            videoTitle=$(printf "%s\n" "$streamInfo" | grep -o '"title":".*\?","len' | sed -e 's/"title"\:"//g' -e 's/","len//g')
            player="mpv"
            shift
            ;;
        -a)
            player="ffplay"
            noDisplay=" -nodisp"
            shift
            ;;
        *)
            [ -z "$1" ] && printf "Missing Link" && exit 1
            youtubeLink=$1
            shift
            [ -z "$1" ] && quality="best" || quality=$1
            shift
            ;;
    esac
done

videoStreamLink=$(yt-dlp -g -f "$quality" "$youtubeLink")

case $player in
    mpv)
        printf "Video Title: %s" "$videoTitle"
        mpv --force-media-title="$videoTitle" "$videoStreamLink"
        ;;
    ffplay)
        ffplay -probesize 20M -i "$videoStreamLink" -framedrop -infbuf -autoexit $noDisplay
        ;;
    vlc)
        vlc "$videoStreamLink"
        ;;
esac

